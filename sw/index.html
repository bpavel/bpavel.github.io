<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Offline Reading</title>
  <script src="//cdn.jsdelivr.net/pouchdb/latest/pouchdb.min.js"></script>

</head>
<body>
  <main>        
    <button onclick="document.location.reload(true);" class="btn">Retry Connection</button>
  </main>
  <section>
	
		<p>Capture Image: <input type="file" accept="image/*" id="inputFile" capture="camera"> </p>
		<button onclick="storeFormInfo()" class="btn">Save</button>
	
	<div id="img_meta_data">Please upload a File</div>
  </section>
  
<script>


if ('serviceWorker' in navigator) {
  navigator.serviceWorker
           .register('/sw/sw.js')
           .then(function () { console.log('Service Worker Registered'); });
}
var inputFile = document.querySelector('#inputFile');
var imageMetaData = document.querySelector('#img_meta_data');
var getFile;
var db = new PouchDB('form_images_sample');

function storeFormInfo(){
	console.log('Info saved!');
	getFile = inputFile.files[0];
		
	//
	// IMPORTANT CODE STARTS HERE
	//
	db.put({
	  _id: 'image', 
	  _attachments: {
		"file": {
		  type: getFile.type,
		  data: getFile
		}
	  }
	}).then(function () {
	  return db.getAttachment('image', 'file');
	}).then(function (blob) {
	  var url = URL.createObjectURL(blob);
	  var img = document.createElement('img');
	  img.src = url;
	  document.body.appendChild(img);

	  var fileSize = JSON.stringify(Math.floor(blob.size/1024));
	  var contentType = JSON.stringify(blob.type);

	  imageMetaData.innerText = 'Filesize: ' + fileSize + 'KB, Content-Type: ' + contentType;
	}).catch(function (err) {
	  console.log(err);
	});
	//
	// IMPORTANT CODE ENDS HERE
	//
	
}
</script>  
</body>
</html>